# =============================
# Prometheus Configuration
# Multi-Chain Crypto Wallet
# =============================

global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds
  evaluation_interval: 15s # Evaluate rules every 15 seconds
  scrape_timeout: 10s # Scrape timeout

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager)
  external_labels:
    monitor: 'crypto-wallet'
    environment: 'development'

# Alertmanager configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            # - 'alertmanager:9093'

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'
rule_files:
  # - "alerts/*.yml"
  # - "rules/*.yml"

# A scrape configuration containing exactly one endpoint to scrape:
scrape_configs:
  # =============================
  # Prometheus Self-Monitoring
  # =============================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          component: 'monitoring'

  # =============================
  # Backend API Server
  # =============================
  - job_name: 'backend-api'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['backend:8080']
        labels:
          service: 'backend'
          component: 'api'
          tier: 'application'

  # =============================
  # PostgreSQL Exporter - Core DB
  # =============================
  - job_name: 'postgres-core'
    scrape_interval: 15s
    static_configs:
      - targets: ['postgres-exporter-core:9187']
        labels:
          service: 'postgres'
          component: 'database'
          database: 'core_db'
          tier: 'data'

  # =============================
  # PostgreSQL Exporter - KYC DB
  # =============================
  - job_name: 'postgres-kyc'
    scrape_interval: 15s
    static_configs:
      - targets: ['postgres-exporter-kyc:9188']
        labels:
          service: 'postgres'
          component: 'database'
          database: 'kyc_db'
          tier: 'data'

  # =============================
  # PostgreSQL Exporter - Rates DB
  # =============================
  - job_name: 'postgres-rates'
    scrape_interval: 15s
    static_configs:
      - targets: ['postgres-exporter-rates:9189']
        labels:
          service: 'postgres'
          component: 'database'
          database: 'rates_db'
          tier: 'data'

  # =============================
  # PostgreSQL Exporter - Audit DB
  # =============================
  - job_name: 'postgres-audit'
    scrape_interval: 15s
    static_configs:
      - targets: ['postgres-exporter-audit:9190']
        labels:
          service: 'postgres'
          component: 'database'
          database: 'audit_db'
          tier: 'data'

  # =============================
  # Redis Exporter
  # =============================
  - job_name: 'redis'
    scrape_interval: 10s
    static_configs:
      - targets: ['redis-exporter:9121']
        labels:
          service: 'redis'
          component: 'cache'
          tier: 'data'

  # =============================
  # Node Exporter (Optional)
  # System-level metrics
  # =============================
  - job_name: 'node'
    scrape_interval: 30s
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          service: 'node'
          component: 'system'
          tier: 'infrastructure'

  # =============================
  # Next.js Frontend (Optional)
  # If frontend exposes metrics endpoint
  # =============================
  # - job_name: 'frontend'
  #   scrape_interval: 30s
  #   metrics_path: '/api/metrics'
  #   static_configs:
  #     - targets: ['frontend:3000']
  #       labels:
  #         service: 'frontend'
  #         component: 'ui'
  #         tier: 'presentation'

  # =============================
  # Blockchain RPC Endpoints (Optional)
  # Custom exporter for blockchain metrics
  # =============================
  # - job_name: 'blockchain-monitor'
  #   scrape_interval: 60s
  #   metrics_path: '/metrics'
  #   static_configs:
  #     - targets: ['blockchain-exporter:9200']
  #       labels:
  #         service: 'blockchain'
  #         component: 'adapter'
  #         tier: 'external'

# =============================
# Remote Write Configuration (Optional)
# For long-term storage or federation
# =============================
# remote_write:
#   - url: "http://remote-prometheus:9090/api/v1/write"
#     queue_config:
#       max_samples_per_send: 1000
#       max_shards: 200
#       capacity: 2500

# =============================
# Remote Read Configuration (Optional)
# For querying remote storage
# =============================
# remote_read:
#   - url: "http://remote-prometheus:9090/api/v1/read"
